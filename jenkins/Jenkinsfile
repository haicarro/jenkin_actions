pipeline {
    agent any

    stages {
        stage('Build') {
            agent none
            steps {
                sh "ls -l devops"
                sh "docker ps"
            }
        }
        
        stage('Deploy') {
            steps {
                echo 'Deploying....'
                withPythonEnv('/home/ec2-user/venv/venv38/') {
                    sh "python --version"
                    withAWS(credentials:'jenkins-aws-credentials-productions', region: 'ap-southeast-1') {
                        sh "python devops/deploy.py"
                    }
                }
            }
        }

    }
}